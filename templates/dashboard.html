<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<title>Dashboard</title>
	</head>

	<body>
		<header>
			<nav>
				<a href="/logout">Logout</a>
				<a href="/evaluate">Evaluate</a>
			</nav>

			{% with messages = get_flashed_messages() %}
				{% if messages %}
					<ul>
					{% for message in messages %}
						<li>{{ message }}</li>
					{% endfor %}
					</ul>
				{% endif %}
			{% endwith %}
		</header>

		<main>
			<h1>{{ current_user.username }}'s Dashboard</h1>

			<div>
				Sort by:
				<select id="pageSelect" onchange="redirectToPage()">
					<option value="created_at">Timestamp</option>
					<option value="filename">Filename</option>
				</select>
			</div>

			<section>
				<h2>All Evaluations</h2>
				{% if evaluations %}
					<ul>
						{% for evaluation in evaluations %}
							{% with table_results=evaluation.data, filename=evaluation.filename, timestamp=evaluation.created_at, id=evaluation.id %}
								{% include 'evaluation_table.html' %}
							{% endwith %}
						{% endfor %}
					</ul>
				{% else %}
					<p>You have no evaluations.</p>
				{% endif %}
			</section>
		</main>

		<script>
			function redirectToPage() {
				var pageSelect = document.getElementById('pageSelect');
				var selectedValue = pageSelect.options[pageSelect.selectedIndex].value;
				window.location.href = '/dashboard?sort_by=' + selectedValue;
			}

			function deleteAlert(id) {
				var confirmDelete = confirm('Are you sure you want to delete this evaluation?');
				if (confirmDelete) {
					window.location = `/api/deleteEval/${id}`;
				}
			}
		</script>
	</body>
</html>